#!/usr/bin/env bash
# vie feb 20 12:44:53 CET 2015

url=
max=5000
date="$(date "+%d%m%Y_%H%M%S")"
logfile="${0##.*}_${date}.log"
formatfile="curl.format"
cookiejar="cookies.jar"
csvheader="time_namelookup;time_connect;time_appconnect;time_pretransfer;time_redirect;time_starttransfer;time_total;http_code;num_redirects;speed_download;size_download;url_effective"
csvformat="%{time_namelookup};%{time_connect};%{time_appconnect};%{time_pretransfer};%{time_redirect};%{time_starttransfer};%{time_total};%{http_code};%{num_redirects};%{speed_download};%{size_download};%{url_effective}\\n"
ua="Mozilla/5.0 (X11; Linux x86_64; rv:29.0) Gecko/20100101 Firefox/29.0"

if [ -z "$1" ]; then
    echo "Usage: $0 <URL>"
    exit 1
else
    url="$1"
fi

echo "[*]"
echo "[*] ----------------------------------------"
echo "[*] Starting at $(date)"
echo "[*]   max req: $max"
echo "[*]   target:  $url"
echo "[*]   uagent:  $ua"
echo "[*]   logfile: $logfile"
echo "[*] ----------------------------------------"
echo "[*]"

echo "$csvheader" > "$logfile"

for i in {0..5000}; do
#for i in $(seq $max); do
    curl -Lks -A "$ua" -o /dev/null -w "$csvformat" "$url" \
        | sed -e 's/,/./g;s/;/,/g' >> "$logfile" 2>&1
    echo -n "."
done

echo "[*]"
echo "[*] Requests issued: $max"
echo "[*] Finished at $(date)"
echo "[*]"
echo

exit 0
