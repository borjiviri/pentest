#!/bin/bash
# borja@libcrack.so
# Install tcpdump on an Android device

set -e
set -u

bin="tcpdump"
binzip="tcpdump.arm_eabi4_static.gz"
path="/system/xbin"

gunzip -k -c "${binzip}" > "${bin}"
adb push "${bin}" /sdcard/
adb shell su -c mount -o remount,rw /system
adb shell su -c cp "/sdcard/${bin}" "${path}/${bin}"
adb shell su -c chmod 0755 "${path}/${bin}"
adb shell su -c chown root:shell "${path}/${bin}"
#adb shell su -c mv /system/bin/sh /system/bin/sh0
#adb shell su -c ln -s "${path}/${bin}" /system/bin/sh
adb shell su -c mount -o remount,ro /system
adb shell su -c rm "/sdcard/${bin}"

rm "${bin}"
echo "${path}/${bin}" installed

