#!/usr/bin/env bash
# mar jun 14 18:54:23 CEST 2016

appname="$1"

[[ -z "$appname" ]] && {
    printf "\e[31mUsage:\e[0m $0 <android.bundle.name>\n"
    exit 1
}

tmpdir="/data/local/tmp"
date="$(date "+%d%m%Y_%H%M%S")"

newname="${appname}-${date}"
appdir="/data/data/${appname}"

device="$(adb devices | grep '^[a-z0-9]' | awk '{print $1}')"

[[ -z "$device" ]] && {
    printf "\e[32mERROR:\e[0m Cannot find adb device\n"
    exit 1
}

printf "\e[32m[+]\e[0m Copy ${appdir} to a temp location\n"
adb shell su -c "cp -r  "${appdir}" "${tmpdir}""

printf "\e[32m[+]\e[0m Setting temp permissions on ${tmpdir}/${appname}\n"
adb shell su -c "chown -R shell:shell "${tmpdir}/${appname}""

printf "\e[32m[+]\e[0m Pulling ${appname} files\n"
adb pull   "${tmpdir}/${appname}" "${newname}"

printf "\e[32m[+]\e[0m Deleting ${tmpdir}/${appname}\n"
adb shell su -c "rm -rf "${tmpdir}/${appname}""

printf "\e[32m[+]\e[0m Done\n"
sleep 5

exit $?
