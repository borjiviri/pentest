#!/usr/bin/env bash

test -z "$1" && echo "Usage: $0 IP" && exit 1

ip="$1"
date=$(date "+%d%m%Y_%H%M%S")
pcap="${taskid}_${date}.pcap"
screenid="tcpdump_${taskid}_${date}"
screencmd="tcpdump -w $pcap -i $iface host $ip"
iface="eth0"

echo ">> Capturing traffic $ip to $pcap on $iface "
screen -d -m -S "$screenid" \
    tcpdump -w "$pcap" -i "$iface" "host $ip" \
    || echo "ERROR creating screen"
sleep 0.5
echo -n ">> Screen: "
screen -ls | grep "$screenid" | awk '{print $1}'

